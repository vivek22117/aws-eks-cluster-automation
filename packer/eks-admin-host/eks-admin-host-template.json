{
  "variables": {
    "region" : "us-east-1",
    "source_ami" : "ami-02354e95b39ca8dec",
    "terraform_version": "0.13.5",
    "kubectl_version": "1.20.4",
    "ami_name": "eks-admin-{{isotime `2006-01-02`}}"
  },
  "builders": [{
    "type" : "amazon-ebs",
    "profile" : "cg-admin",
    "region" : "{{user `region`}}",
    "instance_type" : "t3a.small",
    "source_ami" : "{{user `source_ami`}}",
    "ssh_username" : "ec2-user",
    "ami_name" : "{{user `ami_name`}}",
    "ami_description" : "Amazon linux image for eks-admin",
    "run_tags" : {
      "Name" : "packer-builder-bastion",
      "Project": "Learning-TF"
    },
    "tags" : {
      "CreationDate": "{{isotime `2006-01-02`}}",
      "Tool" : "Packer",
      "Author" : "Vivek",
      "Name": "EKS-Admin-Host-AMI",
      "Project": "Learning-AWS"
    }
  }],
  "provisioners": [
    {
      "type" : "shell",
      "scripts" : ["./setup.sh"],
       "environment_vars": [
         "TERRAFORM_VER={{user `terraform_version`}}",
         "KUBECTL_VER={{user `kubectl_version`}}"
       ],
      "execute_command" : "{{ .Vars }} sudo -E -S sh '{{ .Path }}'",
      "pause_before": "10s"
    }
  ]
}